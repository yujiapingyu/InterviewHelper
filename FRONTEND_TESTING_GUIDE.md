# 前端UI测试指南

## 已实现的功能

### 1. AI额度显示 ✅
**位置**：页面右上角导航栏

**显示内容**：
- 黄色渐变按钮，显示当前AI额度（例如：`💰 100 ポイント`）
- 点击可查看详细信息

**测试步骤**：
1. 登录后，查看右上角是否显示额度
2. 新用户应该显示 `100 ポイント`（初始额度）
3. 点击额度按钮，应打开"AIポイント管理"模态框

---

### 2. 设置页面（Notion配置）✅
**位置**：页面右上角"⚙️设置"按钮

**功能**：
- 修改用户名
- 配置Notion API Key
- 配置Notion Database ID
- 保存设置

**测试步骤**：
1. 点击右上角"设置"图标
2. 看到三个配置项：
   - ユーザー名
   - Notion API Key（密码框）
   - Notion Database ID
3. 填写Notion配置（可选）：
   ```
   API Key: secret_xxxxxxxxxx
   Database ID: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```
4. 点击"保存"
5. 应该提示"設定を保存しました！"

**Notion配置说明**：
- 页面中有蓝色提示框，说明需要的数据库列
- API Key输入框旁有"取得方法 →"链接，指向Notion集成页面

---

### 3. AI额度管理模态框 ✅
**打开方式**：点击右上角黄色额度按钮

**包含内容**：

#### 3.1 当前余额卡片
- 黄色渐变背景
- 显示当前ポイント数
- "チャージ"按钮（打开充值窗口）

#### 3.2 AI操作料金表
完整的价格表，显示所有8种AI操作：

| 操作 | 说明 | 消费ポイント |
|------|------|--------------|
| 生成面试问题 | 履歴書に基づいて面接問題を生成 | 💰 5 |
| 评估回答 | 回答の質を分析・評価 | 💰 3 |
| 生成追问 | 深掘り追問を生成 | 💰 3 |
| 评估追问答案 | 追問の回答を評価 | 💰 3 |
| 分析单词 | 単語の翻訳・解説・例文を生成 | 💰 2 |
| 导入文档 | 文書から面接問題を抽出 | 💰 8 |
| 解析问题 | 標準答案・技巧・摘要を生成 | 💰 5 |
| 解析履历书 | 履歴書から情報を抽出 | 💰 10 |

#### 3.3 使用履歴
显示所有AI操作的历史记录：
- 操作类型
- 描述
- 时间
- 消费点数（红色为扣费，绿色为充值）
- 余额变化（100 → 95）

**测试步骤**：
1. 点击右上角黄色额度按钮
2. 查看当前余额
3. 查看料金表（应该有8行）
4. 查看使用履歴（新用户为空）
5. 执行一次AI操作后，刷新查看履歴更新

---

### 4. 充值功能 ✅
**打开方式**：
1. 点击额度按钮 → 点击"チャージ"
2. 或直接在额度管理模态框中点击"チャージ"

**充值套餐**：
| 价格 | 基础ポイント | ボーナス | 总ポイント | 标签 |
|------|--------------|----------|-----------|------|
| ¥1 | 100 | 0 | 100 | - |
| ¥5 | 500 | 100 | 600 | - |
| ¥10 | 1000 | 300 | 1300 | 🏆 人気 |
| ¥30 | 3000 | 1200 | 4200 | - |
| ¥50 | 5000 | 2500 | 7500 | - |

**测试步骤**：
1. 打开充值窗口
2. 看到蓝色提示框："💡 開発環境での充值"
3. 看到5个充值套餐按钮
4. ¥10套餐有"人気"标签，黄色高亮边框
5. 点击任意套餐按钮（例如¥10）
6. 应该提示"1300ポイントをチャージしました"（或相应数量）
7. 额度按钮更新显示新余额

**开发环境说明**：
- 目前是手动充值（直接调用API）
- 生产环境需要接入支付系统
- 提示框中有说明

---

## 完整功能测试流程

### 场景1：新用户注册流程
1. 注册账号（自动获得100点初始额度）
2. 登录后，右上角显示"💰 100 ポイント"
3. 点击额度按钮查看详情
4. 点击"設定"配置用户名和Notion（可选）

### 场景2：使用AI功能消费额度
1. 点击"質問管理" → "AI生成"
2. 生成3个HR问题（消费5点）
3. 查看额度变为95点
4. 打开额度管理，查看使用履歴，应该有一条记录：
   ```
   生成面试问题
   Generated 3 HR questions
   2025-11-30 12:00:00
   -5 (100 → 95)
   ```

### 场景3：额度不足测试
1. 手动将用户额度设为2点（通过数据库或多次操作）
   ```sql
   UPDATE users SET ai_credits = 2 WHERE id = 1;
   ```
2. 尝试生成问题（需要5点）
3. 应该看到错误提示："この操作には5ポイント必要です。現在のポイント: 2"
4. 点击充值，充值100点
5. 额度变为102点
6. 重新尝试生成问题，成功

### 场景4：Notion配置测试
1. 打开设置
2. 填入Notion API Key和Database ID
3. 保存
4. 在单词本页面，选择一个日语单词
5. 点击分析（消费2点）
6. 保存单词
7. 如果Notion配置正确，应该显示"✅ 保存成功！📝 已同步到Notion"
8. 去Notion数据库查看，应该有新记录

### 场景5：查看使用统计
1. 执行以下操作：
   - 生成2次问题（-10点）
   - 分析5个单词（-10点）
   - 评估3次回答（-9点）
   - 充值100点（+100点）
2. 打开额度管理
3. 使用履歴应该显示9条记录
4. 当前余额应为：100（初始）- 10 - 10 - 9 + 100 = 171点

---

## UI预览

### 导航栏（Header）
```
┌─────────────────────────────────────────────────────────────────┐
│ 日本面接練習器  ようこそ、山田太郎さん     [💰 100 ポイント] [⚙️] [ログアウト] │
└─────────────────────────────────────────────────────────────────┘
```

### 额度管理模态框
```
┌───────────────────────────────────────────────┐
│ 💰 AIポイント管理                        [×]    │
├───────────────────────────────────────────────┤
│  ╔═══════════════════════════════════════╗   │
│  ║  現在の残高                               ║   │
│  ║  100 ポイント            [チャージ]       ║   │
│  ╚═══════════════════════════════════════╝   │
│                                               │
│  ✨ AI操作の料金表                             │
│  ┌─────────────────────────────────────┐     │
│  │ 操作          │ 説明         │ ポイント │     │
│  ├─────────────────────────────────────┤     │
│  │ 生成面试问题  │ ...          │ 💰 5    │     │
│  │ 评估回答      │ ...          │ 💰 3    │     │
│  │ ...                                 │     │
│  └─────────────────────────────────────┘     │
│                                               │
│  📜 使用履歴                                   │
│  ┌─────────────────────────────────────┐     │
│  │ 生成面试问题                           │     │
│  │ Generated 3 HR questions              │     │
│  │ 2025-11-30 12:00:00          -5       │     │
│  │                         100 → 95      │     │
│  └─────────────────────────────────────┘     │
│                                               │
│                       [閉じる]                 │
└───────────────────────────────────────────────┘
```

### 充值模态框
```
┌───────────────────────────────────────────────┐
│ 💳 ポイントチャージ                       [×]    │
├───────────────────────────────────────────────┤
│  💡 開発環境での充值：直接ポイントをチャージ   │
│                                               │
│  ┌──────────┐  ┌──────────┐                  │
│  │   ¥1     │  │   ¥5     │                  │
│  │ 💰 100   │  │ 💰 600   │                  │
│  │          │  │+100ボーナス│                  │
│  └──────────┘  └──────────┘                  │
│                                               │
│  ┌──────────┐  ┌──────────┐                  │
│  │🏆  ¥10   │  │   ¥30    │                  │
│  │ 💰 1300  │  │ 💰 4200  │                  │
│  │+300ボーナス│  │+1200ボーナス│                  │
│  └──────────┘  └──────────┘                  │
│                                               │
│  ┌──────────┐                                 │
│  │   ¥50    │                                 │
│  │ 💰 7500  │                                 │
│  │+2500ボーナス│                                 │
│  └──────────┘                                 │
│                                               │
│                    [キャンセル]                 │
└───────────────────────────────────────────────┘
```

### 设置模态框
```
┌───────────────────────────────────────────────┐
│ ⚙️ 設定                                  [×]    │
├───────────────────────────────────────────────┤
│  ユーザー情報                                   │
│  ┌─────────────────────────────────────┐     │
│  │ ユーザー名： [____________]            │     │
│  └─────────────────────────────────────┘     │
│                                               │
│  📚 Notion連携設定（単語帳同期）               │
│  自分のNotion APIキーとデータベースIDを設定... │
│                                               │
│  ┌─────────────────────────────────────┐     │
│  │ Notion API Key:  [取得方法 →]         │     │
│  │ [****************************]        │     │
│  └─────────────────────────────────────┘     │
│                                               │
│  ┌─────────────────────────────────────┐     │
│  │ Notion Database ID:                   │     │
│  │ [________________________________]    │     │
│  │ NotionデータベースURLの最後の部分(32文字) │     │
│  └─────────────────────────────────────┘     │
│                                               │
│  💡 Notionデータベースには以下の列が必要です： │
│     単語(Title), 翻訳(Text), ...              │
│                                               │
│              [保存]  [キャンセル]               │
└───────────────────────────────────────────────┘
```

---

## 常见问题

**Q: 额度显示不出来？**
A: 确保数据库迁移成功，用户表有`ai_credits`字段。运行：
```bash
npm run db:migrate
```

**Q: 点击充值没反应？**
A: 检查浏览器控制台是否有错误。确保后端API运行正常：
```bash
curl http://localhost:3002/api/credits/costs
```

**Q: Notion同步失败？**
A: 
1. 检查API Key和Database ID是否正确
2. 确保Notion数据库有正确的列
3. 查看浏览器控制台和服务器日志

**Q: 如何重置用户额度？**
A: 数据库操作：
```sql
-- 设为1000点
UPDATE users SET ai_credits = 1000 WHERE email = 'test@example.com';

-- 查看充值记录
SELECT * FROM ai_credits_log WHERE user_id = 1 ORDER BY created_at DESC;
```

---

## 后续改进建议

### 短期（1-2周）
- [ ] 添加额度不足的弹窗提示（目前是alert）
- [ ] 在每个AI操作按钮旁显示需要的点数
- [ ] 添加"低额度警告"（剩余<20点时显示提示）
- [ ] 优化充值成功后的动画效果

### 中期（1个月）
- [ ] 集成真实支付系统（支付宝/微信支付）
- [ ] 添加充值优惠券功能
- [ ] 实现VIP会员系统（月费制）
- [ ] 添加额度消费统计图表

### 长期（3个月+）
- [ ] 管理后台（查看所有用户额度、充值记录）
- [ ] 推荐系统（邀请好友获得额度）
- [ ] 积分商城（额度兑换实物礼品）
- [ ] A/B测试不同定价策略
